<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>國立成功大學114學年度新生註冊時程</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- New Styles from index.html --- */
        :root {
            --color-primary: #53267F;
            --color-text: #333;
            --color-background: #f8f9fa;
            --color-light-gray: #e9ecef;
            --color-white: #fff;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
            --border-radius: 4px;
            --event-bar-height: 22px;
            --event-bar-v-margin: 2px;

            --cat-registration: #007bff;
            --cat-academic: #28a745;
            --cat-housing: #fd7e14;
            --cat-financial: #dc3545;
            --cat-reduction: #fd46c9;
            --cat-activity: #17a2b8;
        }
        header {
            text-align: center;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--color-light-gray);
            margin-bottom: 1.2rem;
        }
        body {
            font-family: 'Noto Sans TC', 'system-ui', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Layout for the new calendar view */
        #calendar-view-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-top: 2rem;
            margin-left: auto;
            margin-right: auto;
            max-width: 1200px;
        }

        @media (min-width: 992px) {
            #calendar-view-content {
                grid-template-columns: 300px 1fr;
            }
        }

        .overview-section, .calendar-section {
            background: var(--color-white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .calendar-section {
            position: relative;
        }

        .overview-section h2, .calendar-section h2 {
            font-size: 1.5rem;
            margin-top: 0;
            color: var(--color-primary);
        }

        /* Overview Section */
        .overview-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .overview-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        .overview-item.done {
            opacity: 0.5;
        }
        
        .overview-item.done .item-title {
            text-decoration: line-through;
        }

        .overview-item input[type="checkbox"] {
            margin-right: 0.75rem;
            min-width: 16px;
            height: 16px;
        }

        .item-title {
            flex-grow: 1;
            font-size: 0.95rem;
        }

        .category-tag {
            padding: 0.2em 0.6em;
            border-radius: var(--border-radius);
            color: var(--color-white);
            font-size: 0.75rem;
            white-space: nowrap;
        }

        /* Calendar Section */
        .calendar-container {
            position: relative;
        }

        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-controls button {
            background: none;
            border: 1px solid var(--color-light-gray);
            border-radius: var(--border-radius);
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background-color 0.2s ease;
        }

        .calendar-controls button:hover {
            background-color: var(--color-light-gray);
        }

        #current-month-year {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--color-primary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: 1fr;
            gap: 1px;
            position: relative;
            background-color: var(--color-light-gray);
            border: 1px solid var(--color-light-gray);
        }

        .calendar-header {
            text-align: center;
            font-weight: bold;
            color: var(--color-primary);
            padding: 0.5rem 0;
            background-color: var(--color-white);
        }

        .calendar-day {
            background-color: #fff;
            position: relative;
            padding: 4px;
            padding-top: 30px;
            min-height: 120px;
            box-sizing: border-box;
        }
        
        .calendar-day.other-month {
            background-color: #fdfdff;
        }

        .calendar-day.other-month .day-number {
            opacity: 0.4;
        }

        .day-number {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.85rem;
            z-index: 2;
        }
        
        .calendar-day.today .day-number {
            background-color: var(--color-primary);
            color: var(--color-white);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        #event-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .event-bar {
            font-size: 0.75rem;
            padding: 0 8px;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            position: absolute;
            height: var(--event-bar-height);
            line-height: var(--event-bar-height);
            box-sizing: border-box;
            pointer-events: auto;
            transition: opacity 0.3s ease;
        }

        .event-bar.start-cap {
            border-top-left-radius: var(--border-radius);
            border-bottom-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
        }

        .event-bar.end-cap {
            border-top-right-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
            border-top-left-radius: var(--border-radius);
            border-bottom-left-radius: var(--border-radius);
        }
        
        .event-bar:hover {
            opacity: 0.8;
            z-index: 3;
        }
        
        .event-bar.done {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .calendar-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--color-light-gray);
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
        }

        .legend-color-box {
            width: 16px;
            height: 16px;
            border-radius: var(--border-radius);
            margin-right: 0.5rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1000;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--color-white);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            width: 90%;
            max-width: 600px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-light-gray);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--color-primary);
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            line-height: 1;
        }
        
        .modal-body p {
            margin: 0 0 1rem 0;
        }
        
        .modal-body strong {
            color: var(--color-primary);
            margin-right: 0.5rem;
        }

        .modal-body a {
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 500;
        }

        .modal-body a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .event-bar { font-size: 0.7rem; height: 20px; line-height: 20px; }
            .calendar-header { font-size: 0.8rem; }
            .modal-content { padding: 1.5rem; }
            .modal-header h3 { font-size: 1.3rem; }
        }
        
        @media (max-width: 480px) {
            #calendar-view-content { grid-template-columns: 1fr; }
            .calendar-grid { gap: 1px; }
            .calendar-day { min-height: 80px; padding-top: 25px; }
            .day-number { font-size: 0.75rem; }
            .event-bar { display: none; } /* Hide event text on very small screens */
            .dots-container { 
                position: absolute;
                bottom: 4px;
                left: 0;
                right: 0;
                text-align: center;
            }
            .event-dot { /* Show a dot instead */
                display: inline-block;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                margin: 0 1px;
            }
        }

        /* --- Styles for Full List View (Untouched) --- */
        .completed {
            opacity: 0.5;
        }
        .completed .task-title {
            text-decoration: line-through;
        }
        .task-details {
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        .task-details.open {
            max-height: 1000px;
        }

    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="main-container container mx-auto p-4 md:p-8">
        <header>
            <h1 class="text-2xl md:text-3xl font-bold text-[var(--color-primary)]">國立成功大學114學年度新生註冊時程<br><a href="https://reg-acad.ncku.edu.tw/?Lang=zh-tw" target="_blank" style="text-decoration: underline; color: #007bff; font-size: large;">（詳情請見清大註冊組）</a> <a href="https://reg-acad.ncku.edu.tw/var/file/41/1041/img/317216909.pdf" target="_blank" style="text-decoration: underline; color: #007bff; font-size: large;">（資料來源PDF檔）</a></h1>
            <p class="text-gray-500 mt-2">※請使用電腦進行瀏覽，如使用手機請將手機轉成橫的※ </p>
            <p class="text-gray-500 mt-2">※免責聲明：實際日程請以成大官方公告和PDF為準，本網站資料為由AI讀取PDF後整理產生，不負任何相關責任※ </p>
 
        </header>

        <!-- View Switcher (Untouched) -->
        <div class="flex justify-center mb-8 bg-gray-200 rounded-lg p-1 max-w-sm mx-auto">
            <button id="btn-calendar-view" class="w-1/2 p-2 rounded-md text-sm font-medium focus:outline-none transition-colors duration-300">日曆模式</button>
            <button id="btn-list-view" class="w-1/2 p-2 rounded-md text-sm font-medium focus:outline-none transition-colors duration-300">完整列表模式</button>
        </div>

        <!-- Calendar View (Replaced) -->
        <div id="calendar-view">
            <div id="calendar-view-content">
                <aside class="overview-section">
                    <h2 id="overview-title" class="text-2xl md:text-3xl font-bold text-[var(--color-primary)]"></h2><br>
                    <ul class="overview-list" id="overview-list"></ul>
                </aside>
                <section class="calendar-section">
                    <div class="calendar-controls">
                        <button id="prev-month-btn">‹</button>
                        <h2 id="current-month-year"></h2>
                        <button id="next-month-btn">›</button>
                    </div>
                    <div class="calendar-container">
                        <div class="calendar-grid" id="calendar-grid"></div>
                        <div id="event-layer"></div>
                    </div>
                    <div class="calendar-legend" id="calendar-legend"></div>
                </section>
            </div>
            <div class="modal-overlay" id="event-modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-title"></h3>
                        <button class="modal-close-btn" id="modal-close-btn">&times;</button>
                    </div>
                    <div class="modal-body" id="modal-body"></div>
                </div>
            </div>
        </div>

        <!-- Full List View (Untouched) -->
        <div id="list-view" class="hidden" style="max-width: 1200px; margin-left: auto; margin-right: auto;">
             <div class="mb-6">
                <input type="search" id="search-box" placeholder="搜尋待辦事項 (例如：宿舍、免修)..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a38db8] focus:border-[#53267F] transition">
            </div>
            <div id="list-container" class="space-y-8">
                <!-- Task categories and items will be injected here by original JS -->
            </div>
        </div>
        <footer style="font-size: small; margin-top: 10px; margin-bottom: -20px;">© 2025 國立成功大學114學年度新生註冊時程一覽表. Made by KUAN HSUN & Gemini</footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA (SHARED) ---
        const eventsData = [
    {
        "id": "ncku-basic-data-submit",
        "title": "繳交新生基本資料表",
        "startDate": "2025-08-01T00:00:00",
        "endDate": "2025-08-29T23:59:59",
        "category": "Registration",
        "targetAudience": "學士班一年級新生",
        "details": "請上傳2吋照片，檢附高中畢業證書影本及身分證正反面影本，郵寄或親送至註冊組，以完成報到手續。",
        "responsibleUnit": "註冊組 / 分機:50120"
    },
    {
        "id": "ncku-career-test",
        "title": "完成職業興趣探索及職場共通職能診斷",
        "startDate": "2025-08-01T00:00:00",
        "endDate": "2025-09-07T23:59:59",
        "category": "Activity",
        "targetAudience": "本國籍新生",
        "details": "至「新生基本資料登錄專區」下方填寫兩項測驗，隔天可登入\"[NCKU Future Success+系統](https://futureplus.ncku.edu.tw/ncku_fsp/index.php)\"查詢結果。",
        "responsibleUnit": "生涯發展組 / 分機:50488"
    },
    {
        "id": "ncku-credit-waiver",
        "title": "辦理學分抵免",
        "startDate": "2025-08-01T00:00:00",
        "endDate": "2025-09-12T23:59:59",
        "category": "Academic",
        "targetAudience": "新生、轉學生",
        "details": "應於入學當學期開始上課日起一週內辦理完畢，逾期視同放棄。請至\"[學分抵免系統](https://nckustory.ncku.edu.tw/credit/index.php)\"申請。",
        "responsibleUnit": "註冊組 / 分機:50120"
    },
    {
        "id": "ncku-military-service",
        "title": "辦理在學役男緩徵及儘後召集",
        "startDate": "2025-08-01T00:00:00",
        "endDate": "2025-09-12T23:59:59",
        "category": "Registration",
        "targetAudience": "在學役男",
        "details": "請至生輔組首頁下載「學生兵役狀況調查表」，連同相關證明影本繳交至生活輔導組。",
        "responsibleUnit": "生活輔導組 / 分機:50340"
    },
    {
        "id": "ncku-english-upload-score",
        "title": "上傳英檢成績辦理分級",
        "startDate": "2025-08-01T00:00:00",
        "endDate": "2025-08-24T23:59:59",
        "category": "Academic",
        "targetAudience": "大一新生",
        "details": "如已考過英語檢定測驗，可將成績證明上傳到\"[英語能力分級系統](https://eagle.english.ncku.edu.tw/eagleclassfiy)\"登記模組。",
        "responsibleUnit": "外語中心 / 分機:52273"
    },
    {
        "id": "ncku-adaptability-test",
        "title": "完成新生適應力檢測",
        "startDate": "2025-08-01T00:00:00",
        "endDate": "2025-11-30T23:59:59",
        "category": "Activity",
        "targetAudience": "全體新生",
        "details": "此檢測是為了幫助新生認識自己的特質，請到【網路新生基本資料登錄】介面點選【進行「新生適應力檢測」】。",
        "responsibleUnit": "心理健康與諮商輔導組 / 分機:50328"
    },
    {
        "id": "ncku-english-placement-test",
        "title": "報名及參加英語能力分級測驗",
        "startDate": "2025-08-16T00:00:00",
        "endDate": "2025-09-01T23:59:59",
        "category": "Academic",
        "targetAudience": "大一新生",
        "details": "報名時間為8/16 09:00至8/24 23:59。考試時間為8/29、9/1，擇一參加。請至\"[英語能力分級系統](https://eagle.english.ncku.edu.tw/eagleclassfiy)\"報名。",
        "responsibleUnit": "外語中心 / 分機:52273"
    },
    {
        "id": "ncku-course-selection-1",
        "title": "新生選課",
        "startDate": "2025-08-22T00:00:00",
        "endDate": "2025-09-02T23:59:59",
        "category": "Academic",
        "targetAudience": "大一新生",
        "details": "選課前請先登入\"[成功入口](https://i.ncku.edu.tw/)\"確認帳號啟用。課程資訊可至\"[課程資訊及選課系統](https://course.ncku.edu.tw/)\"查詢。",
        "responsibleUnit": "課務組 / 註冊組"
    },
    {
        "id": "ncku-tuition-payment",
        "title": "列印及繳交學雜費",
        "startDate": "2025-08-22T00:00:00",
        "endDate": "2025-09-08T23:59:59",
        "category": "Financial",
        "targetAudience": "全體新生",
        "details": "請自行至\"[臺灣銀行學雜費入口網](https://school.bot.com.tw/newTwbank/index.aspx)\"下載繳費單並於期限內繳納。",
        "responsibleUnit": "出納組 / 分機:50606, 50607"
    },
    {
        "id": "ncku-student-loan",
        "title": "辦理就學貸款",
        "startDate": "2025-08-25T00:00:00",
        "endDate": "2025-09-11T23:59:59",
        "category": "Financial",
        "targetAudience": "欲申請就學貸款之學生",
        "details": "請於8/25至9/11期間，先至校內「就學貸款申請系統」登錄，再持單至台銀對保。並於9/8至9/11至校內指定地點繳交文件。",
        "responsibleUnit": "生活輔導組 / 分機:50345"
    },
    {
        "id": "ncku-fee-reduction",
        "title": "辦理學雜費減免",
        "startDate": "2025-08-25T00:00:00",
        "endDate": "2025-09-12T23:59:59",
        "category": "Financial",
        "targetAudience": "符合減免資格之學生",
        "details": "請登入\"[減免系統](http://sys.osa.ncku.edu.tw/apply/)\"申請，並依規定上傳文件至Google雲端表單。",
        "responsibleUnit": "生活輔導組 / 分機:50353"
    },
    {
        "id": "ncku-english-waiver",
        "title": "辦理英文課程抵免/免修",
        "startDate": "2025-09-01T00:00:00",
        "endDate": "2025-09-17T23:59:59",
        "category": "Academic",
        "targetAudience": "符合資格之學生",
        "details": "分兩階段：9/1-9/17線上至\"[英文免修系統](https://eagle.english.ncku.edu.tw/)\"登記，9/8-9/17持列印申請單及相關文件至外語中心審核。",
        "responsibleUnit": "外語中心 / 分機:52273"
    },
    {
        "id": "ncku-study-relief-grant",
        "title": "申請安心就學濟助方案",
        "startDate": "2025-09-01T00:00:00",
        "endDate": "2025-09-26T23:59:59",
        "category": "Financial",
        "targetAudience": "符合資格之新生",
        "details": "具本校正式學籍，全戶家庭年收入以低於前一年無須進行綜所稅申報額為原則。新生應於開學後3週內提出申請。",
        "responsibleUnit": "生活輔導組 / 分機:50348"
    },
    {
        "id": "ncku-freshman-camp",
        "title": "新鮮人成長營",
        "startDate": "2025-09-03T00:00:00",
        "endDate": "2025-09-05T23:59:59",
        "category": "Activity",
        "targetAudience": "全體新生",
        "details": "成功登大人—新鮮人成長營，活動資訊請至\"[軍訓室網頁](https://military-osa.ncku.edu.tw/p/412-1055-20794.php?Lang=zh-tw)\"查詢。",
        "responsibleUnit": "軍訓室 / 分機:50758"
    },
    {
        "id": "ncku-course-add-drop",
        "title": "網路補改棄選",
        "startDate": "2025-09-03T00:00:00",
        "endDate": "2025-09-18T23:59:59",
        "category": "Academic",
        "targetAudience": "全校學生",
        "details": "全校學生網路補、改、棄選課程期間。於9月16日13:00前棄選者，成績單不留紀錄。",
        "responsibleUnit": "註冊組 / 分機:50120"
    },
    {
        "id": "ncku-course-withdrawal",
        "title": "辦理課程退選",
        "startDate": "2025-09-19T00:00:00",
        "endDate": "2025-12-05T23:59:59",
        "category": "Academic",
        "targetAudience": "全校學生",
        "details": "採線上簽核辦理，退選之課程將於成績單留下紀錄。",
        "responsibleUnit": "註冊組 / 分機:50120"
    },
    {
        "id": "ncku-health-check",
        "title": "新生體檢",
        "startDate": "2025-08-01T00:00:00",
        "endDate": "2025-09-30T23:59:59",
        "category": "Registration",
        "targetAudience": "全體新生",
        "details": "全數新生皆應於開學前完成體檢，並於9月底前繳交相關文件至衛保組。詳細辦法請查詢\"[衛保組網頁](https://health-epsh.ncku.edu.tw/?Lang=zh-tw)\"。",
        "responsibleUnit": "衛生保健組 / 分機:50430, 50438"
    }
].map(e => ({...e, startDate: new Date(e.startDate), endDate: new Date(e.endDate)}));

        const fullListData = [
    {
        "category": "註冊與報到",
        "id": "ncku-basic-data-submit",
        "isScheduled": true,
        "title": "上網登錄資料與繳交基本資料表",
        "responsibleUnit": "註冊組 / 分機:50120",
        "details": "期限:8月29日以前。\n說明:至本校首頁新生服務區登錄資料，並列印「新生基本資料表」，附上照片、畢業證書影本、身分證影本後，郵寄或親送至註冊組。"
    },
    {
        "category": "註冊與報到",
        "id": "ncku-comprehensive-data-submit",
        "isScheduled": false,
        "title": "繳交學生綜合資料表",
        "responsibleUnit": "生活輔導組 / 分機:50340",
        "details": "說明:於新生基本資料系統登錄後列印，黏貼照片後，以郵寄方式或開學後繳至所屬學系辦公室。"
    },
    {
        "category": "註冊與報到",
        "id": "ncku-tuition-payment",
        "isScheduled": true,
        "title": "列印及繳交學雜費",
        "responsibleUnit": "出納組 / 分機:50606, 50607",
        "details": "時間:8月22日起開放列印，9月8日前完成繳費。\n說明:本校不寄發繳費單，請自行至\"[臺灣銀行學雜費入口網](https://school.bot.com.tw/newTwbank/index.aspx)\"下載。收費標準可查詢\"[註冊組網頁](https://reg-acad.ncku.edu.tw/p/412-1041-5424.php?Lang=zh-tw)\"。"
    },
    {
        "category": "註冊與報到",
        "id": "ncku-student-id-pickup",
        "isScheduled": false,
        "title": "領取學生證",
        "responsibleUnit": "註冊組 / 分機:50120",
        "details": "說明:於開學後，由系辦人員通知班代領取轉發。未能於規定日期完成體檢及註冊手續者，學生證將延後發放。"
    },
    {
        "category": "註冊與報到",
        "id": "ncku-military-service",
        "isScheduled": true,
        "title": "辦理在學役男緩徵及儘後召集",
        "responsibleUnit": "生活輔導組 / 分機:50340",
        "details": "時間:8月1日至9月12日。\n說明:具役男身分之新生、復學生、轉學生等，應繳交學生兵役狀況調查表及相關證明影本至生活輔導組。"
    },
    {
        "category": "註冊與報到",
        "id": "ncku-health-check",
        "isScheduled": true,
        "title": "新生體檢",
        "responsibleUnit": "衛生保健組 / 分機:50430, 50438",
        "details": "期限:9月30日前。\n說明:全體新生皆應於開學前完成體檢，並於開學當月底繳交相關文件至衛保組。詳細辦法請查詢\"[衛保組網頁](https://health-epsh.ncku.edu.tw/?Lang=zh-tw)\"。"
    },
    {
        "category": "課業與學籍",
        "id": "ncku-course-selection-1",
        "isScheduled": true,
        "title": "新生選課",
        "responsibleUnit": "課務組 / 註冊組",
        "details": "時間:8月22日起。\n說明:選課前請先登入\"[成功入口](https://i.ncku.edu.tw/)\"啟用帳號。課程資訊可至\"[課程資訊及選課系統](https://course.ncku.edu.tw/)\"查詢。"
    },
    {
        "category": "課業與學籍",
        "id": "ncku-course-add-drop",
        "isScheduled": true,
        "title": "網路補改棄選",
        "responsibleUnit": "註冊組 / 分機:50120",
        "details": "時間:9月3日 至 9月18日。\n說明:全校學生網路補、改、棄選課程期間。"
    },
    {
        "category": "課業與學籍",
        "id": "ncku-course-withdrawal",
        "isScheduled": true,
        "title": "辦理課程退選",
        "responsibleUnit": "註冊組 / 分機:50120",
        "details": "截止日期:12月5日。\n說明:採線上簽核辦理，成績單將留下「退選」紀錄。"
    },
    {
        "category": "課業與學籍",
        "id": "ncku-credit-waiver",
        "isScheduled": true,
        "title": "辦理學分抵免",
        "responsibleUnit": "註冊組 / 分機:50120",
        "details": "時間:8月1日至9月12日。\n說明:請至\"[學分抵免系統](https://nckustory.ncku.edu.tw/credit/index.php)\"申請，逾期視同自動放棄。"
    },
    {
        "category": "課業與學籍",
        "id": "ncku-english-waiver",
        "isScheduled": true,
        "title": "辦理英文課程抵免/免修",
        "responsibleUnit": "外語中心 / 分機:52273",
        "details": "時間:9月1日至9月17日。\n說明:需完成兩階段流程，先於\"[英文免修系統](https://eagle.english.ncku.edu.tw/)\"線上登記，再於9/8-9/17持列印申請單及證明文件至外語中心審核。"
    },
    {
        "category": "課業與學籍",
        "id": "ncku-english-upload-score",
        "isScheduled": true,
        "title": "上傳英檢成績辦理分級",
        "responsibleUnit": "外語中心 / 分機:52273",
        "details": "時間:8月1日至8月24日。\n說明:已有英語檢定成績者，可上傳至\"[英語能力分級系統](https://eagle.english.ncku.edu.tw/eagleclassfiy)\"以進行模組分發。"
    },
    {
        "category": "課業與學籍",
        "id": "ncku-english-placement-test",
        "isScheduled": true,
        "title": "報名及參加英語能力分級測驗",
        "responsibleUnit": "外語中心 / 分機:52273",
        "details": "報名時間:8月16日至8月24日。\n考試時間:8月29日、9月1日(擇一)。\n說明:未有英檢成績者，需參加此測驗以進行分級。請至\"[英語能力分級系統](https://eagle.english.ncku.edu.tw/eagleclassfiy)\"報名。"
    },
    {
        "category": "課業與學籍",
        "id": "ncku-leave-of-absence",
        "isScheduled": false,
        "title": "辦理休學、退學",
        "responsibleUnit": "註冊組 / 分機:50120",
        "details": "開始時間:8月25日起。\n說明:需親自或委託他人辦理，不受理通訊申請。請至\"[申請表件系統](https://nckustory.ncku.edu.tw/formapply/index.php?auth)\"列印申請表。"
    },
    {
        "category": "財務與補助",
        "id": "ncku-student-loan",
        "isScheduled": true,
        "title": "辦理就學貸款",
        "responsibleUnit": "生活輔導組 / 分機:50345",
        "details": "時間:8月25日至9月11日。\n說明:需先至「就學貸款申請系統」登錄，再到臺灣銀行對保，最後於開學第一週內至學校繳交文件。"
    },
    {
        "category": "財務與補助",
        "id": "ncku-fee-reduction",
        "isScheduled": true,
        "title": "辦理學雜費減免",
        "responsibleUnit": "生活輔導組 / 分機:50353",
        "details": "時間:8月25日至9月12日。\n說明:請至\"[減免系統](http://sys.osa.ncku.edu.tw/apply/)\"申請並依規定上傳文件，請勿先行繳費。"
    },
    {
        "category": "財務與補助",
        "id": "ncku-disadvantaged-grant",
        "isScheduled": false,
        "title": "申請大專校院弱勢學生助學金",
        "responsibleUnit": "生活輔導組 / 分機:50353",
        "details": "公告時間:8月中旬。\n說明:符合資格者請依生輔組網頁公告辦理。此為第1學期申請，於第2學期學雜費中扣除。"
    },
    {
        "category": "財務與補助",
        "id": "ncku-study-relief-grant",
        "isScheduled": true,
        "title": "申請安心就學濟助方案",
        "responsibleUnit": "生活輔導組 / 分機:50348",
        "details": "新生申請期限:9月26日以前。\n說明:符合資格者可提出申請，已申貸就學貸款或校內外服務表現優良者將優先考量。"
    },
    {
        "category": "財務與補助",
        "id": "ncku-deep-plowing-plan",
        "isScheduled": false,
        "title": "申請成功深耕扶助計畫",
        "responsibleUnit": "生活輔導組 / 分機:50351",
        "details": "受理時間:每年3、6、9、11月。\n說明:詳細獎補助內容請參閱\"[成功深耕線上獎補助系統](https://hesp.osa.ncku.edu.tw/?c=auth)\"。"
    },
    {
        "category": "校園生活",
        "id": "ncku-freshman-camp",
        "isScheduled": true,
        "title": "新鮮人成長營",
        "responsibleUnit": "軍訓室 / 分機:50758",
        "details": "時間:9月3日至9月5日。\n說明:活動資訊請至\"[軍訓室網頁](https://military-osa.ncku.edu.tw/p/412-1055-20794.php?Lang=zh-tw)\"查詢。"
    },
    {
        "category": "校園生活",
        "id": "ncku-career-test",
        "isScheduled": true,
        "title": "完成職業興趣探索及職場共通職能診斷",
        "responsibleUnit": "生涯發展組 / 分機:50488",
        "details": "期限:9月7日以前。\n說明:至新生基本資料登錄專區下方填寫，結果可至\"[NCKU Future Success+系統](https://futureplus.ncku.edu.tw/ncku_fsp/index.php)\"查詢。"
    },
    {
        "category": "校園生活",
        "id": "ncku-adaptability-test",
        "isScheduled": true,
        "title": "完成新生適應力檢測",
        "responsibleUnit": "心理健康與諮商輔導組 / 分機:50328",
        "details": "期限:即日起至11月30日止。\n說明:請至【網路新生基本資料登錄】介面點選連結填寫，以幫助了解自我特質與適應大學生活。"
    },
    {
        "category": "校園生活",
        "id": "ncku-dorm-application",
        "isScheduled": false,
        "title": "宿舍申請",
        "responsibleUnit": "住宿服務組 / 分機:86355",
        "details": "說明:114學年度新生住宿申請、繳費、入住等相關訊息，請參閱住宿服務組首頁之\"[新生專區](https://housing-osa.ncku.edu.tw/p/412-1052-18885.php?Lang=zh-tw)\"公告。"
    },
    {
        "category": "校園生活",
        "id": "ncku-scooter-permit",
        "isScheduled": false,
        "title": "申請機車停車證",
        "responsibleUnit": "軍訓室 / 分機:50715",
        "details": "開始時間:9月1日起。\n說明:請至\"[汽機車通行證申請系統](https://stu-mots.osa.ncku.edu.tw/cms_stu/)\"線上登錄申請並完成繳費。"
    }
];
        const CATEGORY_STYLES = {
            Registration: { name: '註冊', color: 'var(--cat-registration)' },
            Academic: { name: '學業', color: 'var(--cat-academic)' },
            Housing: { name: '住宿', color: 'var(--cat-housing)' },
            Financial: { name: '財務', color: 'var(--cat-financial)' },
            Activity: { name: '活動', color: 'var(--cat-activity)' },
            Reduction: { name: '學費減免/優待', color: 'var(--cat-reduction)' }
        };

        // --- STATE (SHARED) ---
        let calendarDate = new Date(); // Date for the calendar view
        let completedTasks = new Set(JSON.parse(localStorage.getItem('completedTasksNTHU')) || []);
        let currentView = 'calendar';

        // --- DOM ELEMENTS (SHARED) ---
        const calendarView = document.getElementById('calendar-view');
        const listView = document.getElementById('list-view');
        const btnCalendarView = document.getElementById('btn-calendar-view');
        const btnListView = document.getElementById('btn-list-view');
        
        // --- SHARED FUNCTIONS ---
        const handleCheckboxChange = (taskId) => {
            if (completedTasks.has(taskId)) {
                completedTasks.delete(taskId);
            } else {
                completedTasks.add(taskId);
            }
            localStorage.setItem('completedTasksNTHU', JSON.stringify([...completedTasks]));
            updateView(); // Re-render the current view
        };

        // --- VIEW SWITCHING LOGIC (UNCHANGED) ---
        const switchView = (view) => {
            localStorage.setItem('View', view);
            currentView = view;
            updateView();
        };

        const updateView = () => {
            if (currentView === 'calendar') {
                btnCalendarView.classList.add('bg-[#53267F]', 'text-white');
                btnCalendarView.classList.remove('bg-transparent', 'text-gray-600');
                btnListView.classList.add('bg-transparent', 'text-gray-600');
                btnListView.classList.remove('bg-[#53267F]', 'text-white');
                calendarView.classList.remove('hidden');
                listView.classList.add('hidden');
                renderCalendarView();
            } else {
                btnListView.classList.add('bg-[#53267F]', 'text-white');
                btnListView.classList.remove('bg-transparent', 'text-gray-600');
                btnCalendarView.classList.add('bg-transparent', 'text-gray-600');
                btnCalendarView.classList.remove('bg-[#53267F]', 'text-white');
                listView.classList.remove('hidden');
                calendarView.classList.add('hidden');
                renderListView();
            }
        };

        // --- CALENDAR VIEW LOGIC (NEW) ---
        const renderCalendarView = () => {
            renderOverview();
            renderCalendar();
            renderLegend();
            addCalendarEventListeners();
        };

        const toUTCDate = (date) => new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const formatDate = (date) => date.toISOString().substring(0, 10);
        const formatDisplayDate = (date) => `${date.getFullYear()}/${String(date.getMonth() + 1).padStart(2, '0')}/${String(date.getDate()).padStart(2, '0')}`;
        const formatTime = (date) => `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;

        const renderOverview = () => {
            const displayDate = new Date();
            document.getElementById('overview-title').textContent = `今天 (${formatDisplayDate(displayDate)}) 的待辦事項`;
            const todaysEvents = eventsData.filter(event => {
                const start = new Date(event.startDate.toDateString());
                const end = new Date(event.endDate.toDateString());
                end.setHours(23, 59, 59, 999);
                return displayDate >= start && displayDate <= end;
            });
            const overviewList = document.getElementById('overview-list');
            if (todaysEvents.length === 0) {
                overviewList.innerHTML = '<li>今天沒有待辦事項，請查看月曆以規劃未來行程。</li>';
                return;
            }
            overviewList.innerHTML = todaysEvents.map(event => `
                <li class="overview-item ${completedTasks.has(event.id) ? 'done' : ''}" data-id="${event.id}">
                    <input type="checkbox" data-id="${event.id}" ${completedTasks.has(event.id) ? 'checked' : ''}>
                    <span class="item-title">${event.title}</span>
                    <span class="category-tag" style="background-color: ${CATEGORY_STYLES[event.category]?.color || '#6c757d'}">
                        ${CATEGORY_STYLES[event.category]?.name || event.category}
                    </span>
                </li>
            `).join('');
        };
        
        const renderCalendar = () => {
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            document.getElementById('current-month-year').textContent = `${year}年 ${month + 1}月`;
            const calendarGrid = document.getElementById('calendar-grid');
            calendarGrid.innerHTML = '';
            ['日', '一', '二', '三', '四', '五', '六'].forEach(day => {
                calendarGrid.innerHTML += `<div class="calendar-header">${day}</div>`;
            });
            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            const firstDateInView = toUTCDate(new Date(firstDayOfMonth.setDate(firstDayOfMonth.getDate() - firstDayOfMonth.getDay())));
            firstDayOfMonth.setDate(1);
            const lastDateInView = toUTCDate(new Date(lastDayOfMonth.setDate(lastDayOfMonth.getDate() + (6 - lastDayOfMonth.getDay()))));
            lastDayOfMonth.setDate(lastDayOfMonth.getDate() - (6 - lastDayOfMonth.getDay()));
            let tempDate = new Date(firstDateInView);
            while(tempDate <= lastDateInView) {
                const isToday = formatDate(tempDate) === formatDate(toUTCDate(new Date()));
                const isOtherMonth = tempDate.getUTCMonth() !== month;
                calendarGrid.innerHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''} ${isOtherMonth ? 'other-month' : ''}" data-date="${formatDate(tempDate)}">
                        <div class="day-number">${tempDate.getUTCDate()}</div>
                        <div class="dots-container"></div>
                    </div>
                `;
                tempDate.setUTCDate(tempDate.getUTCDate() + 1);
            }
            renderEventsInCalendar(year, month, firstDateInView);
        };

        const renderEventsInCalendar = (year, month, firstDateInView) => {
            const eventLayer = document.getElementById('event-layer');
            const calendarGrid = document.getElementById('calendar-grid');
            if (!eventLayer || !calendarGrid) return;
            eventLayer.innerHTML = '';

            if (window.innerWidth <= 480) {
                renderDotsForMobile(year, month);
                return;
            }

            const monthStart = toUTCDate(new Date(year, month, 1));
            const monthEnd = toUTCDate(new Date(year, month + 1, 0));
            const visibleEvents = eventsData.filter(event => toUTCDate(event.startDate) <= monthEnd && toUTCDate(event.endDate) >= monthStart).sort((a, b) => (b.endDate - b.startDate) - (a.endDate - a.startDate));
            const layout = {};
            const eventLayoutInfo = [];

            visibleEvents.forEach(event => {
                let chunkStartDate = new Date(event.startDate);
                while(chunkStartDate <= event.endDate) {
                    if (chunkStartDate.getMonth() > month && chunkStartDate.getFullYear() >= year) break;
                    if (chunkStartDate.getDay() === 0 || chunkStartDate.getTime() === event.startDate.getTime()) {
                        let chunkEndDate = new Date(chunkStartDate);
                        
                        // FIX: The condition now uses toUTCDate to compare dates without time,
                        // preventing the loop from running one extra time.
                        while(chunkEndDate.getDay() < 6 && toUTCDate(chunkEndDate) < toUTCDate(event.endDate)) {
                            chunkEndDate.setDate(chunkEndDate.getDate() + 1);
                        }

                        if (chunkEndDate.getMonth() === month || chunkStartDate.getMonth() === month) {
                            let slot = 0;
                            let slotFound = false;
                            while(!slotFound) {
                                let isSlotAvailable = true;
                                let dateIterator = new Date(chunkStartDate);
                                while(dateIterator <= chunkEndDate) {
                                    const dateKey = formatDate(toUTCDate(dateIterator));
                                    if(layout[dateKey] && layout[dateKey][slot]) {
                                        isSlotAvailable = false;
                                        break;
                                    }
                                    dateIterator.setDate(dateIterator.getDate() + 1);
                                }
                                if(isSlotAvailable) slotFound = true; else slot++;
                            }
                            let dateMarker = new Date(chunkStartDate);
                            while(dateMarker <= chunkEndDate) {
                                const dateKey = formatDate(toUTCDate(dateMarker));
                                if(!layout[dateKey]) layout[dateKey] = [];
                                layout[dateKey][slot] = event.id;
                                dateMarker.setDate(dateMarker.getDate() + 1);
                            }
                            eventLayoutInfo.push({ event, slot, chunkStartDate, chunkEndDate });
                        }
                        chunkStartDate = new Date(chunkEndDate);
                    }
                    chunkStartDate.setDate(chunkStartDate.getDate() + 1);
                }
            });

            const headerHeight = document.querySelector('.calendar-header').offsetHeight;
            const eventBarHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--event-bar-height'));
            const eventBarMargin = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--event-bar-v-margin'));
            const totalEventHeight = eventBarHeight + eventBarMargin;
            const weekMaxSlots = [0,0,0,0,0,0];
            for(const dateKey in layout) {
                const date = toUTCDate(new Date(dateKey));
                const dayIndex = Math.round((date.getTime() - firstDateInView.getTime()) / (1000 * 3600 * 24));
                const weekIndex = Math.floor(dayIndex / 7);
                if(layout[dateKey] && layout[dateKey].length > weekMaxSlots[weekIndex]) {
                    weekMaxSlots[weekIndex] = layout[dateKey].length;
                }
            }
            const gridRowHeights = weekMaxSlots.map(maxSlots => 30 + (maxSlots * totalEventHeight) + 5);
            calendarGrid.style.gridTemplateRows = `auto ${gridRowHeights.map(h => `${h}px`).join(' ')}`;

            eventLayoutInfo.forEach(({ event, slot, chunkStartDate, chunkEndDate }) => {
                const startDayOfWeek = chunkStartDate.getDay();
                const dayIndex = Math.round((toUTCDate(chunkStartDate).getTime() - firstDateInView.getTime()) / (1000 * 3600 * 24));
                const weekIndex = Math.floor(dayIndex / 7);
                const eventBar = document.createElement('div');
                eventBar.className = `event-bar ${completedTasks.has(event.id) ? 'done' : ''}`;
                eventBar.dataset.id = event.id;
                eventBar.textContent = event.title;
                eventBar.style.backgroundColor = CATEGORY_STYLES[event.category]?.color || '#6c757d';
                let top = headerHeight + (weekIndex * 1);
                for(let i=0; i<weekIndex; i++) top += gridRowHeights[i];
                top += (slot * totalEventHeight) + 30;
                eventBar.style.top = `${top}px`;
                const duration = (toUTCDate(chunkEndDate).getTime() - toUTCDate(chunkStartDate).getTime()) / (1000 * 3600 * 24) + 1;
                eventBar.style.left = `calc(${(100 / 7) * startDayOfWeek}% + 2px)`;
                eventBar.style.width = `calc(${(100 / 7) * duration}% - 4px)`;
                if (formatDate(toUTCDate(event.startDate)) === formatDate(toUTCDate(chunkStartDate)) || chunkStartDate.getDay() === 0) eventBar.classList.add('start-cap');
                if (formatDate(toUTCDate(event.endDate)) === formatDate(toUTCDate(chunkEndDate)) || chunkEndDate.getDay() === 6) eventBar.classList.add('end-cap');
                eventLayer.appendChild(eventBar);
            });
        };

        const renderDotsForMobile = (year, month) => {
            const visibleEvents = eventsData.filter(event => {
                const eventEnd = new Date(event.endDate);
                eventEnd.setHours(23, 59, 59, 999);
                return event.startDate <= new Date(year, month + 1, 0) && eventEnd >= new Date(year, month, 1);
            });
            visibleEvents.forEach(event => {
                let iterDate = new Date(event.startDate);
                while (iterDate <= event.endDate) {
                    if (iterDate.getMonth() === month) {
                        const dayCell = document.querySelector(`.calendar-day[data-date="${formatDate(toUTCDate(iterDate))}"]`);
                        if (dayCell && !dayCell.querySelector(`.dots-container [data-id="${event.id}"]`)) {
                            const dotContainer = dayCell.querySelector('.dots-container');
                            const eventDot = document.createElement('div');
                            eventDot.className = 'event-dot';
                            eventDot.style.backgroundColor = CATEGORY_STYLES[event.category]?.color || '#6c757d';
                            eventDot.dataset.id = event.id;
                            dotContainer.appendChild(eventDot);
                        }
                    }
                    iterDate.setDate(iterDate.getDate() + 1);
                }
            });
        };

        const renderLegend = () => {
            const legendContainer = document.getElementById('calendar-legend');
            legendContainer.innerHTML = Object.values(CATEGORY_STYLES).map(style => `
                <div class="legend-item">
                    <div class="legend-color-box" style="background-color: ${style.color};"></div>
                    <span>${style.name}</span>
                </div>
            `).join('');
        };

        const showModal = (eventId) => {
            const event = eventsData.find(e => e.id === eventId);
            if (!event) return;
            const detailsHtml = event.details.replace(/\[(.*?)\]\((.*?)\)/g, '<a style="color:blue;" href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
            document.getElementById('modal-title').textContent = event.title;
            document.getElementById('modal-body').innerHTML = `
                <p><strong>辦理期間:</strong> ${formatDisplayDate(event.startDate)} ${formatTime(event.startDate)} - ${formatDisplayDate(event.endDate)} ${formatTime(event.endDate)}</p>
                <p><strong>適用對象:</strong> ${event.targetAudience}</p>
                <p><strong>重要說明:</strong> ${detailsHtml}</p>
                <p><strong>負責單位:</strong> ${event.responsibleUnit}</p>
            `;
            document.getElementById('event-modal').classList.add('visible');
        };

        const closeModal = () => document.getElementById('event-modal').classList.remove('visible');
        
        const addCalendarEventListeners = () => {
            const calendarViewNode = document.getElementById('calendar-view');
            if (calendarViewNode.dataset.listenersAttached) return;

            document.getElementById('prev-month-btn').addEventListener('click', () => {
                calendarDate.setMonth(calendarDate.getMonth() - 1);
                renderCalendar();
            });
            document.getElementById('next-month-btn').addEventListener('click', () => {
                calendarDate.setMonth(calendarDate.getMonth() + 1);
                renderCalendar();
            });
            document.getElementById('modal-close-btn').addEventListener('click', closeModal);
            document.getElementById('event-modal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeModal();
            });
            calendarViewNode.addEventListener('click', (e) => {
                const eventTarget = e.target.closest('.event-bar, .event-dot, .overview-item');
                if (eventTarget) {
                    if (e.target.matches('input[type="checkbox"]')) return;
                    showModal(eventTarget.dataset.id);
                }
            });
            calendarViewNode.addEventListener('change', (e) => {
                if (e.target.matches('input[type="checkbox"]')) {
                    handleCheckboxChange(e.target.dataset.id);
                }
            });
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    if(currentView === 'calendar') renderCalendar();
                }, 250);
            });
            calendarViewNode.dataset.listenersAttached = 'true';
        };

        // --- LIST VIEW LOGIC (UNCHANGED) ---
        const renderListView = () => {
            const listContainer = document.getElementById('list-container');
            const searchBox = document.getElementById('search-box');
            listContainer.innerHTML = '';
            const searchTerm = searchBox.value.toLowerCase();
            const groupedData = fullListData.reduce((acc, item) => {
                const category = item.category;
                if (!acc[category]) acc[category] = [];
                acc[category].push(item);
                return acc;
            }, {});
            for (const category in groupedData) {
                const categoryContainer = document.createElement('div');
                categoryContainer.innerHTML = `<h2 class="text-2xl font-bold text-[#53267F] border-b-2 border-[#a38db8] pb-2 mb-4">${category}</h2>`;
                const itemsList = document.createElement('div');
                itemsList.className = 'space-y-4';
                let hasVisibleItems = false;
                groupedData[category].forEach(item => {
                    const itemText = (item.title + item.details + item.responsibleUnit).toLowerCase();
                    if (itemText.includes(searchTerm)) {
                        const taskCard = createTaskCard(item);
                        itemsList.appendChild(taskCard);
                        hasVisibleItems = true;
                    }
                });
                if (hasVisibleItems) {
                    categoryContainer.appendChild(itemsList);
                    listContainer.appendChild(categoryContainer);
                }
            }
        };

        const createTaskCard = (item) => {
            const isCompleted = completedTasks.has(item.id);
            const card = document.createElement('div');
            card.className = `task-item bg-white p-4 rounded-lg shadow-sm border border-gray-200 transition-opacity ${isCompleted ? 'completed' : ''}`;
            const header = document.createElement('div');
            header.className = 'task-header flex flex-col sm:flex-row sm:items-center sm:justify-between';
            const leftSection = document.createElement('div');
            leftSection.className = 'flex-grow mb-2 sm:mb-0';
            const checkboxLabel = document.createElement('label');
            checkboxLabel.className = 'flex items-center space-x-3 cursor-pointer';
            checkboxLabel.innerHTML = `
                <input type="checkbox" ${isCompleted ? 'checked' : ''} class="h-5 w-5 rounded border-gray-300 text-[#53267F] focus:ring-[#a38db8] flex-shrink-0">
                <span class="task-title text-lg font-semibold text-gray-800">${item.title}</span>`;
            checkboxLabel.querySelector('input').addEventListener('change', () => handleCheckboxChange(item.id));
            leftSection.appendChild(checkboxLabel);
            const unit = document.createElement('p');
            unit.className = 'text-sm text-gray-500 ml-8';
            unit.textContent = item.responsibleUnit;
            leftSection.appendChild(unit);
            const rightSection = document.createElement('div');
            rightSection.className = 'flex-shrink-0 self-start sm:self-center';
            const toggleButton = document.createElement('button');
            toggleButton.className = 'toggle-details text-sm font-medium text-[#53267F] hover:underline flex items-center';
            toggleButton.innerHTML = `<span class="btn-text">[+] 查看說明</span>`;
            rightSection.appendChild(toggleButton);
            header.appendChild(leftSection);
            header.appendChild(rightSection);
            const details = document.createElement('div');
            details.className = 'task-details mt-2 pl-8';
            const detailsHtml = item.details.replace(/\[(.*?)\]\((.*?)\)/g, '<a style="color:blue;" href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
            details.innerHTML = `<div class="bg-gray-50 p-4 rounded-md border text-gray-600 whitespace-pre-wrap">${detailsHtml}</div>`;
            toggleButton.addEventListener('click', () => {
                details.classList.toggle('open');
                const btnText = toggleButton.querySelector('.btn-text');
                btnText.textContent = details.classList.contains('open') ? '[-] 收合說明' : '[+] 查看說明';
            });
            card.appendChild(header);
            card.appendChild(details);
            return card;
        };
        
        // --- APP INITIALIZATION ---
        const init = () => {
            // Setup listeners for non-view-specific elements
            btnCalendarView.addEventListener('click', () => switchView('calendar'))
            btnListView.addEventListener('click', () => switchView('list'));
            document.getElementById('search-box').addEventListener('input', renderListView);
            // Initial view render
            updateView();
        };
        
        init();
        switchView(localStorage.getItem('View')||'calendar');
        setTimeout(() => {
            renderOverview();
            renderCalendar();
        }, 10);
    });
    </script>
</body>
</html>
